<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Enclustra Build Environment - User Documentation</title>
    
    <link rel="stylesheet" href="_static/rtd.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="None" href="index_xilinx.html#document-index_xilinx" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index_xilinx.html#document-index_xilinx">Enclustra Build Environment - User Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="project">
<h1>Enclustra Build Environment - User Documentation<a class="headerlink" href="#project" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<span id="document-introduction"></span><div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This is the user documentation for the Enclustra Build Environment project.</p>
<div class="section" id="version-information">
<h3>Version Information<a class="headerlink" href="#version-information" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Date</th>
<th class="head">Rev</th>
<th class="head">Author</th>
<th class="head">Changes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2015-05-08</td>
<td>0.1.0</td>
<td>Karol Gugala</td>
<td>Builsystem description</td>
</tr>
<tr class="row-odd"><td>2015-05-11</td>
<td>0.1.1</td>
<td>Aleksandra Szawara</td>
<td>Language check</td>
</tr>
<tr class="row-even"><td>2015-07-06</td>
<td>0.1.2</td>
<td>Aurelio Lucchesi</td>
<td>Minor corrections</td>
</tr>
<tr class="row-odd"><td>2015-11-20</td>
<td>0.1.3</td>
<td>Tomasz Gorochowik</td>
<td>Major reorganization</td>
</tr>
<tr class="row-even"><td>2016-06-21</td>
<td>0.1.4</td>
<td>Tomasz Gorochowik</td>
<td>Project mode section</td>
</tr>
</tbody>
</table>
</div>
</div>
<span id="document-system"></span><div class="section" id="build-environment">
<h2>Build Environment<a class="headerlink" href="#build-environment" title="Permalink to this headline">¶</a></h2>
<p>This chapter describes the usage of the build environment.
The whole build environment is written in <code class="docutils literal"><span class="pre">Python</span></code>.
Its internal functionality is determined by <cite>ini</cite> files placed in a specific directory layout.</p>
<div class="section" id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h3>
<p>To run the build script a Python interpreter is required.
The system is compatible with both, Python 2 and Python 3.</p>
<p>The build environment requires additional software to be installed as listed below:</p>
<table border="1" class="docutils" id="sample-table">
<caption><span class="caption-text">Required software</span><a class="headerlink" href="#sample-table" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head stub">tool</th>
<th class="head">minimal version</th>
<th class="head">comments</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><th class="stub">dialog</th>
<td>1.1-20120215</td>
<td>Required only in the GUI mode</td>
</tr>
<tr class="row-odd"><th class="stub">make</th>
<td>3.79.1</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><th class="stub">git</th>
<td>1.7.8</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><th class="stub">mercurial</th>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><th class="stub">tar</th>
<td>1.15</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><th class="stub">curl</th>
<td>7.9.3</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><th class="stub">c++ compiler</th>
<td>&nbsp;</td>
<td>Required to build a busybox rootfs</td>
</tr>
<tr class="row-odd"><th class="stub">gcc</th>
<td>&nbsp;</td>
<td>Required to build the Linux kernel, U-Boot and a busybox rootfs</td>
</tr>
</tbody>
</table>
<p>For more information on how to install the required packages in the supported systems, please refer to the corresponding subsection (<a class="reference internal" href="#suse"><span class="std std-ref">OpenSUSE 13.2 (Harlequin)</span></a>, <a class="reference internal" href="#centos"><span class="std std-ref">CentOS 7</span></a>, <a class="reference internal" href="#ubuntu"><span class="std std-ref">Ubuntu 14.04 LTS</span></a>).</p>
<p>Additionally, the following Python modules are required (this applies to every supported distribution):</p>
<ul class="simple">
<li>os2emxpath</li>
<li>backports</li>
<li>ntpath</li>
<li>pkg_resources</li>
<li>opcode</li>
<li>posixpath</li>
<li>sre_constants</li>
<li>nturl2path</li>
<li>sre_parse</li>
<li>sre_compile</li>
<li>pyexpat</li>
<li>strop</li>
<li>genericpath</li>
<li>repr</li>
</ul>
<p>Those packages can be obtained by using <code class="docutils literal"><span class="pre">pip</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo pip install os2emxpath backports ntpath pkg_resources opcode posixpath sre_constants<span class="se">\</span>
                 nturl2path sre_parse sre_compile pyexpat strop genericpath repr
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Either the <code class="docutils literal"><span class="pre">dialog</span></code> Python module or the external <code class="docutils literal"><span class="pre">dialog</span></code> application is required to use the build environment&#8217;s GUI.</p>
</div>
<div class="section" id="opensuse-13-2-harlequin">
<span id="suse"></span><h4>OpenSUSE 13.2 (Harlequin)<a class="headerlink" href="#opensuse-13-2-harlequin" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo pip install argparse
sudo yzpper install -y dialog git make mercurial
sudo yzpper install -y u-boot-tools gcc patch
sudo yzpper install -y gcc-c++
sudo yzpper install -y flex bison
sudo yzpper install -y linux32
</pre></div>
</div>
</div>
<div class="section" id="centos-7">
<span id="centos"></span><h4>CentOS 7<a class="headerlink" href="#centos-7" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo yum install -y dialog make git tar wget mercurial
sudo yum -y groupinstall <span class="s1">&#39;Development Tools&#39;</span>
sudo yum install -y glibc.i686 libgcc.i686 libstdc++.i686 glibc-devel.i686
</pre></div>
</div>
</div>
<div class="section" id="ubuntu-14-04-lts">
<span id="ubuntu"></span><h4>Ubuntu 14.04 LTS<a class="headerlink" href="#ubuntu-14-04-lts" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo apt-get install -y u-boot-tools
sudo apt-get install -y git
sudo apt-get install -y mercurial
sudo apt-get install -y gcc-multilib
sudo apt-get install -y lib32stdc++6
sudo apt-get install -y python-pip python-dev build-essential
sudo pip install --upgrade pip
sudo pip install --upgrade virtualenv
</pre></div>
</div>
</div>
</div>
<div class="section" id="directory-structure">
<h3>Directory Structure<a class="headerlink" href="#directory-structure" title="Permalink to this headline">¶</a></h3>
<p>The build environment is designed to work with a specific directory structure depicted below:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="p">|</span>-- bin
<span class="p">|</span>-- binaries
<span class="p">|</span>-- buildscripts
<span class="p">|</span>-- sources
<span class="p">|</span>   <span class="p">|</span>-- target_submodule_1
<span class="p">|</span>   <span class="p">|</span>-- target_submodule_2
<span class="p">|</span>   <span class="p">|</span>-- target_submodule_3
<span class="p">|</span>   <span class="p">|</span>-- target_submodule_4
<span class="p">|</span>-- targets
<span class="p">|</span>   <span class="p">|</span>-- Board_1
<span class="p">|</span>       <span class="p">|</span>-- Module_1
<span class="p">|</span>       <span class="p">|</span>-- Module_2
<span class="p">|</span>   <span class="p">|</span>-- Board_2
<span class="p">|</span>       <span class="p">|</span>-- Module_1
<span class="p">|</span>-- target_output
</pre></div>
</div>
<table border="1" class="docutils" id="folder-description">
<caption><span class="caption-text">Folder description</span><a class="headerlink" href="#folder-description" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head stub">Folder</th>
<th class="head">function</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><th class="stub">bin</th>
<td>Remote toolchains installation folder.</td>
</tr>
<tr class="row-odd"><th class="stub">binaries</th>
<td>Additional target binaries download folder.</td>
</tr>
<tr class="row-even"><th class="stub">sources</th>
<td>master_git_repository clone folder. It contains submodule folders.</td>
</tr>
<tr class="row-odd"><th class="stub">buildscripts</th>
<td>Build system executable files.</td>
</tr>
<tr class="row-even"><th class="stub">targets</th>
<td>Target configurations are placed here.</td>
</tr>
<tr class="row-odd"><th class="stub">target_output</th>
<td>Folders generated during the build process, that contain the output files after a successful build of every specifc target.</td>
</tr>
</tbody>
</table>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>By default, the output folders are named according to this folder naming scheme:</p>
<p><code class="docutils literal"><span class="pre">out_&lt;timestamp&gt;_&lt;module&gt;_&lt;board&gt;_&lt;bootmode&gt;</span></code>.</p>
<p class="last">The default name can be overwriten during the build process.</p>
</div>
</div>
<div class="section" id="repositories-structure">
<h3>Repositories Structure<a class="headerlink" href="#repositories-structure" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">sources</span></code> directory is the master git repository with a number of submodules pointing to actual code repositories.
During the fetch phase, the build environment synchronizes only the submodules required to build the selected targets.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>.
<span class="p">|</span>-- container_git_repository
<span class="p">|</span>   <span class="p">|</span>-- target_submodule_1
<span class="p">|</span>   <span class="p">|</span>-- target_submodule_2
<span class="p">|</span>   <span class="p">|</span>-- target_submodule_3
</pre></div>
</div>
</div>
<div class="section" id="general-build-environment-configuration">
<h3>General Build Environment Configuration<a class="headerlink" href="#general-build-environment-configuration" title="Permalink to this headline">¶</a></h3>
<p>Environment settings are stored in the <code class="docutils literal"><span class="pre">enclustra.ini</span></code> file in the main directory of the build environment.
Before starting the build script, one may need to adjust the general settings of the build environment by editing this file.
One of the most crucial setting is the number of build threads used in a parallel.
This parameter is set in the <code class="docutils literal"><span class="pre">[general]</span></code> section by changing the <code class="docutils literal"><span class="pre">ntreads</span></code> key.
Additionally, parameters in the <code class="docutils literal"><span class="pre">[debug]</span></code> section allow the user to adjust the logging settings:</p>
<ul class="simple">
<li>If the <code class="docutils literal"><span class="pre">debug-calls</span></code> option if set to <code class="docutils literal"><span class="pre">true</span></code>, the output of all external tool calls (such as <code class="docutils literal"><span class="pre">make</span></code>, <code class="docutils literal"><span class="pre">tar</span></code> etc.) will be displayed in the terminal.</li>
<li>If the <code class="docutils literal"><span class="pre">quiet-mode</span></code> option is set to <code class="docutils literal"><span class="pre">true</span></code>, the build log of the targets will not be printed to the terminal, only informations about actual build state will be shown. This option does not affect the <code class="docutils literal"><span class="pre">build-logfile</span></code> option.</li>
<li>If the <code class="docutils literal"><span class="pre">build-logfile</span></code> option is set to a file name, the build environment will write the whole build log output to that file. If the option is not set, the output will not be logged.</li>
<li>If the <code class="docutils literal"><span class="pre">break-on-error</span></code> option is set to <code class="docutils literal"><span class="pre">true</span></code>, the build environment will interrupted on the first error. Otherwise the build environment will only print an error message and continue to work on a next available target.</li>
</ul>
</div>
</div>
<span id="document-supported_devices_xilinx"></span><div class="section" id="supported-devices">
<h2>Supported Devices<a class="headerlink" href="#supported-devices" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils" id="supported-devicess">
<caption><span class="caption-text">Supported devices</span><a class="headerlink" href="#supported-devicess" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head stub">Family</th>
<th class="head">Module</th>
<th class="head">Base board</th>
<th class="head">Available targets</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><th class="stub">Xilinx</th>
<td>Mars ZX2</td>
<td>Mars Starter</td>
<td>Linux, U-Boot, Busybox</td>
</tr>
<tr class="row-odd"><th class="stub">Xilinx</th>
<td>Mars ZX2</td>
<td>Mars EB1</td>
<td>Linux, U-Boot, Busybox</td>
</tr>
<tr class="row-even"><th class="stub">Xilinx</th>
<td>Mars ZX2</td>
<td>Mars PM3</td>
<td>Linux, U-Boot, Busybox</td>
</tr>
<tr class="row-odd"><th class="stub">Xilinx</th>
<td>Mars ZX3</td>
<td>Mars Starter</td>
<td>Linux, U-Boot, Busybox</td>
</tr>
<tr class="row-even"><th class="stub">Xilinx</th>
<td>Mars ZX3</td>
<td>Mars EB1</td>
<td>Linux, U-Boot, Busybox</td>
</tr>
<tr class="row-odd"><th class="stub">Xilinx</th>
<td>Mars ZX3</td>
<td>Mars PM3</td>
<td>Linux, U-Boot, Busybox</td>
</tr>
<tr class="row-even"><th class="stub">Xilinx</th>
<td>Mercury ZX1</td>
<td>Mercury PE1</td>
<td>Linux, U-Boot, Busybox</td>
</tr>
<tr class="row-odd"><th class="stub">Xilinx</th>
<td>Mercury ZX5</td>
<td>Mercury PE1</td>
<td>Linux, U-Boot, Busybox</td>
</tr>
</tbody>
</table>
</div>
<span id="document-quickstart_xilinx"></span><div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="gui">
<h3>GUI<a class="headerlink" href="#gui" title="Permalink to this headline">¶</a></h3>
<p>In order to build the software for a chosen board using the GUI, please follow these steps:</p>
<ol class="arabic simple">
<li>Clone the build environment repository with:</li>
</ol>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span>git clone https://github.com/enclustra-bsp/bsp-xilinx.git
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>Change to the enclustra-buildscripts directory:</li>
</ol>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> enclustra-buildscripts
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="3">
<li><p class="first">Run <code class="docutils literal"><span class="pre">./build.sh</span></code> script.</p>
</li>
<li><p class="first">The welcome screen provides basic information about the version of the build environment.</p>
<img alt="_images/welcome_screen.png" src="_images/welcome_screen.png" />
</li>
<li><p class="first">Choose the module type.</p>
<img alt="_images/module_xilinx.png" src="_images/module_xilinx.png" />
</li>
<li><p class="first">Choose the base board type.</p>
<img alt="_images/board_xilinx.png" src="_images/board_xilinx.png" />
</li>
<li><p class="first">Choose the boot device.</p>
<img alt="_images/bootmode.png" src="_images/bootmode.png" />
</li>
<li><p class="first">Choose which targets available for the chosen device family will be fetched. On the bottom of the screen a short description of the highlighted target is displayed. Choosing certain targets may disable fetching others.</p>
<img alt="_images/fetch.png" src="_images/fetch.png" />
</li>
<li><p class="first">Choose which targets will be built. On the bottom of the screen a short description of a highlighted target is displayed. Choosing certain targets may disable building others.</p>
<img alt="_images/build.png" src="_images/build.png" />
</li>
<li><p class="first">Choose the exact version of the device (chip type, industrial/commercial grade, speed grade).</p>
<img alt="_images/dev_option_xilinx.png" src="_images/dev_option_xilinx.png" />
</li>
<li><p class="first">Verify all the chosen build parameters.</p>
<img alt="_images/summary_xilinx.png" src="_images/summary_xilinx.png" />
</li>
<li><p class="first">Choose wheter or not to save the configuration for later use.</p>
<img alt="_images/save_xilinx.png" src="_images/save_xilinx.png" />
</li>
<li><p class="first">The build environment will fetch and build the chosen targets.</p>
</li>
</ol>
</div>
<div class="section" id="command-line">
<h3>Command Line<a class="headerlink" href="#command-line" title="Permalink to this headline">¶</a></h3>
<p>The build process can be invoked from the command line. All options that are available in the GUI are present on the command line interface as well.
A list of the available command line options can be obtained like this:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>./build.sh --help

usage: build.sh [-h] [-L] [-d device] [-l] [-x target] [-f target] [-b target]
            [--fetch-history target] [--list-dev-options] [-o index] [-c] [-v]

Enclustra Build Environment

optional arguments:
  -h, --help                    show this help message and exit
  -L, --list-devices            list all available devices
  -d device, --device device    specify device as follows:
                                &lt;module&gt;/&lt;base_board&gt;/&lt;boot_device&gt;
  -l, --list-targets            list all targets for chosen device
  -x target                     fetch and build specific target
  -f target, --fetch target     fetch specific target
  -b target, --build target     build specific target
  --fetch-history target        fetch specific target with history
  --list-dev-options            list all available device options for chosen
                                device
  -o index, --dev-option index  set device option by index, the default one
                                will be used if not specified
  -c, --clean-all               delete all downloaded code, binaries, tools
                                and built files
  -v, --version                 print version
</pre></div>
</div>
<p>In order to list all available devices use the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>./build.sh -L
</pre></div>
</div>
<p>If the <code class="docutils literal"><span class="pre">build.sh</span></code> script is invoked with the <code class="docutils literal"><span class="pre">-d</span></code> option, the build environment switches to console mode.
This mode requires a valid device specifier in order to locate the device configuration within the <code class="docutils literal"><span class="pre">targets</span></code> directory for the specific device, e.g. for the <cite>Mars ZX3</cite> module on the <cite>Mars PM3</cite> base board in <cite>QSPI</cite> boot mode, the command would look like this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>./build.sh -d Mars_ZX3/Mars_PM3/QSPI
</pre></div>
</div>
<p>Such a command will fetch and build all the default targets for a selected device.
To list all the available targets for a selected device, the user needs to add the <code class="docutils literal"><span class="pre">-l</span></code> switch to the command, e.g.:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>./build.sh -d Mars_ZX3/Mars_PM3/QSPI -l
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">-x</span></code> option will fetch and build only the selected target, e.g.:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>./build.sh -d Mars_ZX3/Mars_PM3/QSPI -x Linux
</pre></div>
</div>
<p>That will fetch and build only the <code class="docutils literal"><span class="pre">Linux</span></code> target for the selected device.</p>
<p>To only fetch or build a specific target, the user can specify those targets with the <code class="docutils literal"><span class="pre">-f</span></code> (fetch) and <code class="docutils literal"><span class="pre">-b</span></code> (build) options. It is possible to choose multiple targets, e.g. like this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>./build.sh -d Mars_ZX3/Mars_PM3/QSPI -f Linux -b BusyBox -x U-Boot
</pre></div>
</div>
<p>This will fetch Linux, build BusyBox and fetch/build U-Boot.</p>
<p>The <code class="docutils literal"><span class="pre">--list-dev-options</span></code> option will list all the available device options for the chosen device. It can be used like this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>./build.sh -d Mars_ZX3/Mars_PM3/QSPI -x Linux --list-dev-options
</pre></div>
</div>
<p>This will print out an indexed list of device options.</p>
<p>The <code class="docutils literal"><span class="pre">-o</span></code> option allows the user to choose a device option for the selected device by providing the index of a specific device option, like this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>./build.sh -d Mars_ZX3/Mars_PM3/QSPI -x Linux -o 1
</pre></div>
</div>
<p>If no device option is selected, the default one will be used.</p>
<p>To reset the build environment and delete all downloaded code, binaries, tools and built files, the <code class="docutils literal"><span class="pre">--clean</span></code> option can be used:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>./build.sh --clean
</pre></div>
</div>
</div>
</div>
<div class="section" id="deployment">
<h2>Deployment<a class="headerlink" href="#deployment" title="Permalink to this headline">¶</a></h2>
<p>This chapter describes how to prepare the hardware to boot from different boot media, using the binaries generated from the build environment.
The boot process differs in its details on different hardware, but in general it covers the following steps:</p>
<ol class="arabic simple">
<li>BootRom embedded in a CPU starts execution after reset. It searches through a predefined storages for a next (first) stage boot loader.</li>
<li>First stage boot loader (FSBL, U-Boot SPL) is loaded into On Chip Memory, and executed.</li>
<li>First stage boot loader initializes RAM controller, clocks and loads second stage boot loader into RAM.</li>
<li>Second stage boot loader (U-Boot) loads the Linux kernel, device tree blob and any other required files into RAM and runs the Linux kernel.</li>
<li>Linux kernel configures peripherals, mounts user space root filesystem and executes the <code class="docutils literal"><span class="pre">init</span></code> application within it.</li>
<li><code class="docutils literal"><span class="pre">Init</span></code> application starts the rest of the user space applications - the system is up and running.</li>
</ol>
<p>For more detailed information about the boot process on a Xilinx Zynq devices please refer to:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.xilinx.com/support/documentation/user_guides/ug585-Zynq-7000-TRM.pdf">Xilinx Zynq technical reference guide (chapters 6 and 32)</a>.</li>
</ul>
<p>All the guides in this section require the user to build the required files for chosen device, with the build environment, like described in the previous section.
After building the files, they can be deployed to the hardware, like described in the following sub sections.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Default target output folders are named according to this folder naming scheme:</p>
<p class="last"><code class="docutils literal"><span class="pre">out_&lt;timestamp&gt;_&lt;module&gt;_&lt;board&gt;_&lt;bootmode&gt;</span></code>.</p>
</div>
<p>As a general note on U-Boot used in all the following guides: U-Boot is using variables from the default environment. Moreover, the boot scripts used by U-Boot also rely on those variables. - If the environment was changed and saved earlier, U-Boot will always use these saved environment variables on a fresh boot, even after changing the U-Boot environment.
To restore the default environment, run the following command in the U-Boot command line:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>env default -a
</pre></div>
</div>
<p>This will not overwrite the stored environment but will only restore the default one in the current run.
To permanently restore the default environment, the <code class="docutils literal"><span class="pre">saveenv</span></code> command has to be invoked.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A warning like that <code class="docutils literal"><span class="pre">***</span> <span class="pre">Warning</span> <span class="pre">-</span> <span class="pre">bad</span> <span class="pre">CRC,</span> <span class="pre">using</span> <span class="pre">default</span> <span class="pre">environment</span></code> when booting into U-Boot indicates that the default environment will be loaded.</p>
</div>
<div class="section" id="sd-card-mmc">
<span id="xilinx-mmc"></span><h3>SD Card (MMC)<a class="headerlink" href="#sd-card-mmc" title="Permalink to this headline">¶</a></h3>
<p>In order to deploy images to an SD Card and boot from it, do the following steps:</p>
<ol class="arabic">
<li><p class="first">Create a FAT formatted BOOT partition as the first one on a SD Card. The size of the partition should be at least 16 MB. (For more information on how to prepare the boot medium, please refer to the official <a class="reference external" href="http://www.wiki.xilinx.com/Prepare+Boot+Medium">Xilinx guide</a>.)</p>
</li>
<li><p class="first">Create an ext2 formatted partition (rootfs) as the second one on a SD Card. The size of the partition should be at least 16 MB.</p>
</li>
<li><p class="first">Copy <code class="docutils literal"><span class="pre">boot.bin</span></code>, <code class="docutils literal"><span class="pre">uImage</span></code>, <code class="docutils literal"><span class="pre">devicetree.dtb</span></code> and <code class="docutils literal"><span class="pre">uboot.scr</span></code> from the build environment output directory onto the BOOT partition (FAT formatted).</p>
</li>
<li><p class="first">Extract the <code class="docutils literal"><span class="pre">rootfs.tar</span></code> archive from the build environment output directory onto the second partition (rootfs, ext2 formatted). This must be done as a root.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo tar -xpf rootfs.tar -C /path/to/mmc/mountpoint
</pre></div>
</div>
</li>
<li><p class="first">Unmount all partitions mounted from the SD Card.</p>
</li>
<li><p class="first">Insert the card into the SD Card slot on the board.</p>
</li>
<li><p class="first">Configure the board to boot from the SD Card (refer to the board User Manual).</p>
</li>
<li><p class="first">Power on the board.</p>
</li>
<li><p class="first">The board should boot the Linux system.</p>
</li>
</ol>
<p>If one wants to manually trigger booting from a SD Card, the following command has to be invoked from the U-Boot command line:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>run sdboot
</pre></div>
</div>
</div>
<div class="section" id="qspi-flash">
<span id="xilinx-qspi"></span><h3>QSPI Flash<a class="headerlink" href="#qspi-flash" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils" id="xilinx-qspi-flash-layout">
<caption><span class="caption-text">Xilinx Family QSPI Flash Layout</span><a class="headerlink" href="#xilinx-qspi-flash-layout" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head stub">Partition</th>
<th class="head">Offset</th>
<th class="head">Size</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><th class="stub">Boot image</th>
<td>0x0</td>
<td>0x600000</td>
</tr>
<tr class="row-odd"><th class="stub">Linux kernel</th>
<td>0x600000</td>
<td>0x500000</td>
</tr>
<tr class="row-even"><th class="stub">Linux Device Tree</th>
<td>0xB00000</td>
<td>0x80000</td>
</tr>
<tr class="row-odd"><th class="stub">U-Boot environment</th>
<td>0xB08000</td>
<td>0x80000</td>
</tr>
<tr class="row-even"><th class="stub">Bootscript</th>
<td>0xC00000</td>
<td>0x80000</td>
</tr>
<tr class="row-odd"><th class="stub">Rootfs</th>
<td>0xC40000</td>
<td>0x3C0000</td>
</tr>
</tbody>
</table>
<p>In order to deploy images to QSPI Flash and boot from it, do the following steps:</p>
<ol class="arabic">
<li><p class="first">Setup a TFTP server on the host computer.</p>
</li>
<li><p class="first">Power on the board and boot to U-Boot (e.g. from a SD Card (MMC)).</p>
</li>
<li><p class="first">Connect an Ethernet cable to the device.</p>
</li>
<li><p class="first">Connect a serial console to the device (e.g. using PuTTY or picocom).</p>
</li>
<li><p class="first">Setup the U-Boot connection parameters (in the U-Boot console):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>setenv ipaddr <span class="s1">&#39;xxx.xxx.xxx.xxx&#39;</span>
<span class="c1"># where xxx.xxx.xxx.xxx is the board address</span>
setenv serverip <span class="s1">&#39;yyy.yyy.yyy.yyy&#39;</span>
<span class="c1"># where yyy.yyy.yyy.yyy is the server (host computer) address</span>
</pre></div>
</div>
</li>
<li><p class="first">Copy <code class="docutils literal"><span class="pre">boot.bin</span></code>, <code class="docutils literal"><span class="pre">uImage</span></code>, <code class="docutils literal"><span class="pre">devicetree.dtb</span></code>, <code class="docutils literal"><span class="pre">uboot.scr</span></code> and <code class="docutils literal"><span class="pre">uramdisk</span></code> from the build environment output directory to the TFTP server directory</p>
</li>
<li><p class="first">Set memory pinmux to QSPI Flash:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>zx_set_storage QSPI
</pre></div>
</div>
</li>
<li><p class="first">Update the boot image:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mw.b <span class="si">${</span><span class="nv">bootimage_loadaddr</span><span class="si">}</span> 0xFF <span class="si">${</span><span class="nv">bootimage_size</span><span class="si">}</span>
tftpboot <span class="si">${</span><span class="nv">bootimage_loadaddr</span><span class="si">}</span> <span class="si">${</span><span class="nv">bootimage_image</span><span class="si">}</span>
sf probe
sf erase <span class="si">${</span><span class="nv">qspi_bootimage_offset</span><span class="si">}</span> <span class="si">${</span><span class="nv">bootimage_size</span><span class="si">}</span>
sf write <span class="si">${</span><span class="nv">bootimage_loadaddr</span><span class="si">}</span> <span class="si">${</span><span class="nv">qspi_bootimage_offset</span><span class="si">}</span> <span class="si">${</span><span class="nv">filesize</span><span class="si">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Update the boot script image:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mw.b <span class="si">${</span><span class="nv">bootscript_loadaddr</span><span class="si">}</span> 0xFF <span class="si">${</span><span class="nv">bootscript_size</span><span class="si">}</span>
tftpboot <span class="si">${</span><span class="nv">bootscript_loadaddr</span><span class="si">}</span> <span class="si">${</span><span class="nv">bootscript_image</span><span class="si">}</span>
sf probe
sf erase <span class="si">${</span><span class="nv">qspi_bootscript_offset</span><span class="si">}</span> <span class="si">${</span><span class="nv">bootscript_size</span><span class="si">}</span>
sf write <span class="si">${</span><span class="nv">bootscript_loadaddr</span><span class="si">}</span> <span class="si">${</span><span class="nv">qspi_bootscript_offset</span><span class="si">}</span> <span class="si">${</span><span class="nv">filesize</span><span class="si">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Update the Linux kernel:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mw.b <span class="si">${</span><span class="nv">kernel_loadaddr</span><span class="si">}</span> 0xFF <span class="si">${</span><span class="nv">kernel_size</span><span class="si">}</span>
tftpboot <span class="si">${</span><span class="nv">kernel_loadaddr</span><span class="si">}</span> <span class="si">${</span><span class="nv">kernel_image</span><span class="si">}</span>
sf probe
sf erase <span class="si">${</span><span class="nv">qspi_kernel_offset</span><span class="si">}</span> <span class="si">${</span><span class="nv">kernel_size</span><span class="si">}</span>
sf write <span class="si">${</span><span class="nv">kernel_loadaddr</span><span class="si">}</span> <span class="si">${</span><span class="nv">qspi_kernel_offset</span><span class="si">}</span> <span class="si">${</span><span class="nv">filesize</span><span class="si">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Update the devicetree image:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mw.b <span class="si">${</span><span class="nv">devicetree_loadaddr</span><span class="si">}</span> 0xFF <span class="si">${</span><span class="nv">devicetree_size</span><span class="si">}</span>
tftpboot <span class="si">${</span><span class="nv">devicetree_loadaddr</span><span class="si">}</span> <span class="si">${</span><span class="nv">devicetree_image</span><span class="si">}</span>
sf probe
sf erase <span class="si">${</span><span class="nv">qspi_devicetree_offset</span><span class="si">}</span> <span class="si">${</span><span class="nv">devicetree_size</span><span class="si">}</span>
sf write <span class="si">${</span><span class="nv">devicetree_loadaddr</span><span class="si">}</span> <span class="si">${</span><span class="nv">qspi_devicetree_offset</span><span class="si">}</span> <span class="si">${</span><span class="nv">filesize</span><span class="si">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Update the rootfs image:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mw.b <span class="si">${</span><span class="nv">ramdisk_loadaddr</span><span class="si">}</span> 0xFF <span class="si">${</span><span class="nv">ramdisk_size</span><span class="si">}</span>
tftpboot <span class="si">${</span><span class="nv">ramdisk_loadaddr</span><span class="si">}</span> <span class="si">${</span><span class="nv">ramdisk_image</span><span class="si">}</span>
sf probe
sf erase <span class="si">${</span><span class="nv">qspi_ramdisk_offset</span><span class="si">}</span> <span class="si">${</span><span class="nv">ramdisk_size</span><span class="si">}</span>
sf write <span class="si">${</span><span class="nv">ramdisk_loadaddr</span><span class="si">}</span> <span class="si">${</span><span class="nv">qspi_ramdisk_offset</span><span class="si">}</span> <span class="si">${</span><span class="nv">filesize</span><span class="si">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Power off the board.</p>
</li>
<li><p class="first">Configure the board to boot from the QSPI Flash (refer to the board User Manual).</p>
</li>
<li><p class="first">Power on the board.</p>
</li>
<li><p class="first">The board should boot the Linux system.</p>
</li>
</ol>
<p>If one wants to manually trigger booting from the QSPI Flash, the following command has to be invoked from the U-Boot command line:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>run qspiboot
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that step 8 to 12 can be invoked independently.</p>
</div>
</div>
<div class="section" id="nand-flash">
<span id="xilinx-nand"></span><h3>NAND Flash<a class="headerlink" href="#nand-flash" title="Permalink to this headline">¶</a></h3>
<p>The Xilinx family devices cannot boot directly from a NAND Flash memory.
The FSBL and the U-Boot have to be started from SD Card (MMC) or QSPI Flash.
Please refer to <a class="reference internal" href="#xilinx-mmc"><span class="std std-ref">SD Card (MMC)</span></a> or <a class="reference internal" href="#xilinx-qspi"><span class="std std-ref">QSPI Flash</span></a> in order to boot U-Boot from SD Card or QSPI Flash.
When U-Boot is booted it can load and boot the Linux system stored on the NAND Flash memory.</p>
<table border="1" class="docutils" id="id1">
<caption><span class="caption-text">Xilinx Family NAND Flash Layout</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head stub">Partition</th>
<th class="head">Offset</th>
<th class="head">Size</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><th class="stub">Linux kernel</th>
<td>0x0</td>
<td>0x500000</td>
</tr>
<tr class="row-odd"><th class="stub">Linux Device Tree</th>
<td>0x500000</td>
<td>0x100000</td>
</tr>
<tr class="row-even"><th class="stub">Bootscript</th>
<td>0x600000</td>
<td>0x100000</td>
</tr>
<tr class="row-odd"><th class="stub">Rootfs</th>
<td>0x700000</td>
<td>Rest of the NAND Storage space</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Not all Xilinx-based modules come with NAND Flash memory.</p>
</div>
<p>In order to deploy images and boot the Linux system from NAND Flash, do the following steps:</p>
<ol class="arabic">
<li><p class="first">Setup an TFTP server on the host computer.</p>
</li>
<li><p class="first">Power on the board and boot to U-Boot (e.g. from a SD Card (MMC)).</p>
</li>
<li><p class="first">Connect an Ethernet cable to the device.</p>
</li>
<li><p class="first">Connect a serial console to the device (e.g. using PuTTY or picocom).</p>
</li>
<li><p class="first">Copy <code class="docutils literal"><span class="pre">uImage</span></code>, <code class="docutils literal"><span class="pre">devicetree.dtb</span></code>, <code class="docutils literal"><span class="pre">uboot.scr</span></code> and <code class="docutils literal"><span class="pre">rootfs.ubi</span></code>  files from the build environment output directory to the TFTP server directory.</p>
</li>
<li><p class="first">Setup the U-Boot connection parameters (in the U-Boot console):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>setenv ipaddr <span class="s1">&#39;xxx.xxx.xxx.xxx&#39;</span>
<span class="c1"># where xxx.xxx.xxx.xxx is the board address</span>
setenv serverip <span class="s1">&#39;yyy.yyy.yyy.yyy&#39;</span>
<span class="c1"># where yyy.yyy.yyy.yyy is the server (host computer) address</span>
</pre></div>
</div>
</li>
<li><p class="first">Stop the U-Boot autoboot.</p>
</li>
<li><p class="first">Set the memory pinmux to NAND Flash:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>zx_set_storage NAND
</pre></div>
</div>
</li>
<li><p class="first">Update the boot script image:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mw.b <span class="si">${</span><span class="nv">bootscript_loadaddr</span><span class="si">}</span> 0xFF <span class="si">${</span><span class="nv">bootscript_size</span><span class="si">}</span>
tftpboot <span class="si">${</span><span class="nv">bootscript_loadaddr</span><span class="si">}</span> <span class="si">${</span><span class="nv">bootscript_image</span><span class="si">}</span>
nand device 0
nand erase.part nand-bootscript
nand write <span class="si">${</span><span class="nv">bootscript_loadaddr</span><span class="si">}</span> nand-bootscript <span class="si">${</span><span class="nv">filesize</span><span class="si">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Update the Linux kernel:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mw.b <span class="si">${</span><span class="nv">kernel_loadaddr</span><span class="si">}</span> 0xFF <span class="si">${</span><span class="nv">kernel_size</span><span class="si">}</span>
tftpboot <span class="si">${</span><span class="nv">kernel_loadaddr</span><span class="si">}</span> <span class="si">${</span><span class="nv">kernel_image</span><span class="si">}</span>
nand device 0
nand erase.part nand-linux
nand write <span class="si">${</span><span class="nv">kernel_loadaddr</span><span class="si">}</span> nand-linux <span class="si">${</span><span class="nv">filesize</span><span class="si">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Update the devicetree image:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mw.b <span class="si">${</span><span class="nv">devicetree_loadaddr</span><span class="si">}</span> 0xFF <span class="si">${</span><span class="nv">devicetree_size</span><span class="si">}</span>
tftpboot <span class="si">${</span><span class="nv">devicetree_loadaddr</span><span class="si">}</span> <span class="si">${</span><span class="nv">devicetree_image</span><span class="si">}</span>
nand device 0
nand erase.part nand-device-tree
nand write <span class="si">${</span><span class="nv">devicetree_loadaddr</span><span class="si">}</span> nand-device-tree <span class="si">${</span><span class="nv">filesize</span><span class="si">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Update the rootfs image:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mw.b <span class="si">${</span><span class="nv">ubifs_loadaddr</span><span class="si">}</span> 0xFF <span class="si">${</span><span class="nv">ubifs_size</span><span class="si">}</span>
tftpboot <span class="si">${</span><span class="nv">ubifs_loadaddr</span><span class="si">}</span> <span class="si">${</span><span class="nv">ubifs_image</span><span class="si">}</span>
nand device 0
nand erase.part nand-rootfs
nand write <span class="si">${</span><span class="nv">ubifs_loadaddr</span><span class="si">}</span> nand-rootfs <span class="si">${</span><span class="nv">filesize</span><span class="si">}</span>
</pre></div>
</div>
</li>
<li><p class="first">Trigger NAND Flash boot with:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>run nandboot
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that step 8 to 11 can be invoked independently.</p>
</div>
</div>
<div class="section" id="usb-drive">
<h3>USB Drive<a class="headerlink" href="#usb-drive" title="Permalink to this headline">¶</a></h3>
<p>The Xilinx family devices cannot boot directly from a USB Drive.
The FSBL and the U-Boot have to be started from SD Card (MMC) or QSPI Flash.
Please refer to <a class="reference internal" href="#xilinx-mmc"><span class="std std-ref">SD Card (MMC)</span></a> or <a class="reference internal" href="#xilinx-qspi"><span class="std std-ref">QSPI Flash</span></a> in order to boot U-Boot from SD Card or QSPI Flash.
When U-Boot is booted it can load and boot the Linux system stored on the USB Drive.</p>
<p>In order to deploy images and boot the Linux system from a USB Drive, do the following steps:</p>
<ol class="arabic">
<li><p class="first">Create a FAT formatted partition as the first partition on the drive. This partition should have at least 16 MiB. (For more information on how to prepare the boot medium, please refer to the official <a class="reference external" href="http://www.wiki.xilinx.com/Prepare+Boot+Medium">Xilinx guide</a>.)</p>
</li>
<li><p class="first">Copy <code class="docutils literal"><span class="pre">uImage</span></code>, <code class="docutils literal"><span class="pre">devicetree.dtb</span></code>, <code class="docutils literal"><span class="pre">uramdisk</span></code> and <code class="docutils literal"><span class="pre">uboot.scr</span></code> from the build environment output directory to the FAT formatted partition.</p>
</li>
<li><p class="first">Insert the USB drive into the USB port of the board.</p>
</li>
<li><p class="first">Configure the board to boot from the SD Card (MMC) or QSPI Flash (refer to the board User Manual).</p>
</li>
<li><p class="first">Power on the board and stop the U-Boot autoboot.</p>
</li>
<li><p class="first">Trigger USB boot with:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>run usbboot
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="nfs">
<h3>NFS<a class="headerlink" href="#nfs" title="Permalink to this headline">¶</a></h3>
<p>The Xilinx family devices cannot boot directly from NFS.</p>
<p>The FSBL and the U-Boot have to be started from SD Card (MMC), with the images generated by the build environment. When U-Boot is booted it can load and boot the Linux system from the host machine via Ethernet. Please refer to <span class="xref std std-ref">nfs_preparation_guide</span> to prepare your system for NFS boot.</p>
<p>In order to deploy images and boot the Linux system over NFS, do the following steps:</p>
<ol class="arabic">
<li><p class="first">Create a FAT formatted BOOT partition as the first one on a SD Card. The size of the partition should be at least 16 MB. (For more information on how to prepare the boot medium, please refer to the official <a class="reference external" href="http://www.wiki.xilinx.com/Prepare+Boot+Medium">Xilinx guide</a>.)</p>
</li>
<li><p class="first">Copy <code class="docutils literal"><span class="pre">boot.bin</span></code> and <code class="docutils literal"><span class="pre">uboot.scr</span></code> from the build environment output directory onto the BOOT partition.</p>
</li>
<li><p class="first">Extract the <code class="docutils literal"><span class="pre">rootfs.tar</span></code> archive from the build environment output directory into the NFS folder. This must be done as a root.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sudo tar -xpf rootfs.tar -C /path/to/NFS
</pre></div>
</div>
</li>
<li><p class="first">Copy the <code class="docutils literal"><span class="pre">uImage</span></code>,  <code class="docutils literal"><span class="pre">devicetree.dtb</span></code> and <code class="docutils literal"><span class="pre">uboot.scr</span></code> to the TFTP folder.</p>
</li>
<li><p class="first">Insert the card into the SD Card slot on the board.</p>
</li>
<li><p class="first">Configure the board to boot from the SD Card (MMC).</p>
</li>
<li><p class="first">Power on the board and stop the U-Boot autoboot.</p>
</li>
<li><p class="first">Set the server&#8217;s and target&#8217;s IP address, and the path to the rootfs NFS folder.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>env default -a
setenv ipaddr 192.168.1.10
setenv serverip 192.168.1.2
setenv serverpath /path/to/NFS
saveenv
</pre></div>
</div>
</li>
<li><p class="first">Trigger NFS boot with:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>run netboot
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Saving the U-Boot environment like above ensures that NFS boot will work automatically after reboot.</p>
</div>
</div>
</div>
<span id="document-project_mode"></span><div class="section" id="project-mode">
<h2>Project mode<a class="headerlink" href="#project-mode" title="Permalink to this headline">¶</a></h2>
<p>For users who want to use the Enclustra Build Environment, but still be able to modify the parts of the system, a &#8216;project mode&#8217; is available.</p>
<p>Project mode is similar to regular mode, but enables user to fully customize all the parts of the system.</p>
<p>To enable project mode, choose &#8220;Advanced&#8221; option on the very last screen of the GUI workflow.</p>
<blockquote>
<div><img alt="_images/project_name.png" src="_images/project_name.png" />
</div></blockquote>
<p>Check the &#8216;enable&#8217; option on.</p>
<blockquote>
<div><img alt="_images/project_enable.png" src="_images/project_enable.png" />
</div></blockquote>
<p>Continue as usual.</p>
<p>After the regular build has finished, the sources of the components that were chosen to be fetched, are going to be copied to the output directory.
User is free to modify those sources and add a git upstream to them to keep them versioned.</p>
<p>Besides the sources, a new build script called build.sh is generated.
This script will run the Enclustra Build Environment in a special project mode.
In this mode the step for choosing components to fetch is skipped, and the user is prompted to choose which of the components to build.
If any of the components of the system were modified, the Build system will build them, and include the output files in the final boot images.</p>
</div>
<span id="document-faq"></span><div class="section" id="faq">
<h2>FAQ<a class="headerlink" href="#faq" title="Permalink to this headline">¶</a></h2>
<div class="section" id="how-to-script-u-boot">
<h3>How to script U-Boot?<a class="headerlink" href="#how-to-script-u-boot" title="Permalink to this headline">¶</a></h3>
<p>All U-Boot commands can be automated by scripting, so that it is much more convenient to deploy flash images to the hardware.</p>
<p>For example, QSPI deployment:</p>
<p>Put the following commands as plain text to a file <code class="docutils literal"><span class="pre">cmd.txt</span></code>:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>mw.b ${bootimage_loadaddr} 0xFF ${bootimage_size}
tftpboot ${bootimage_loadaddr} ${bootimage_image}
sf probe
sf erase ${qspi_bootimage_offset} ${bootimage_size}
sf write ${bootimage_loadaddr} ${qspi_bootimage_offset} ${filesize}

mw.b ${bootscript_loadaddr} 0xFF ${bootscript_size}
tftpboot ${bootscript_loadaddr} ${bootscript_image}
sf probe
sf erase ${qspi_bootscript_offset} ${bootscript_size}
sf write ${bootscript_loadaddr} ${qspi_bootscript_offset} ${filesize}

mw.b ${kernel_loadaddr} 0xFF ${kernel_size}
tftpboot ${kernel_loadaddr} ${kernel_image}
sf probe
sf erase ${qspi_kernel_offset} ${kernel_size}
sf write ${kernel_loadaddr} ${qspi_kernel_offset} ${filesize}

mw.b ${devicetree_loadaddr} 0xFF ${devicetree_size}
tftpboot ${devicetree_loadaddr} ${devicetree_image}
sf probe
sf erase ${qspi_devicetree_offset} ${devicetree_size}
sf write ${devicetree_loadaddr} ${qspi_devicetree_offset} ${filesize}

mw.b ${ramdisk_loadaddr} 0xFF ${ramdisk_size}
tftpboot ${ramdisk_loadaddr} ${ramdisk_image}
sf probe
sf erase ${qspi_ramdisk_offset} ${ramdisk_size}
sf write ${ramdisk_loadaddr} ${qspi_ramdisk_offset} ${filesize}

run qspiboot
</pre></div>
</div>
<p>Then generate an image <code class="docutils literal"><span class="pre">cmd.img</span></code> and put it onto the TFTP server on the host computer like this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mkimage -T script -C none -n <span class="s2">&quot;QSPI flash commands&quot;</span> -d cmd.txt cmd.img
cp cmd.img /tftpboot
</pre></div>
</div>
<p>And finally, load the file on the target platform in U-boot and execute it, like this (after step 5 Setup U-Boot connection parameters, in the user documentation):</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>tftpboot 100000 cmd.img
source 100000
</pre></div>
</div>
</div>
<div class="section" id="how-can-the-flash-memory-be-programmed-from-linux">
<h3>How can the flash memory be programmed from Linux?<a class="headerlink" href="#how-can-the-flash-memory-be-programmed-from-linux" title="Permalink to this headline">¶</a></h3>
<p>In order to program flash memory from Linux, a script like the following one can be used. - All required files need to be present in the current folder. They can be loaded via TFTP or from USB drive / SD card.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

getsize <span class="o">()</span>
<span class="o">{</span>
        <span class="nb">local</span>  <span class="nv">size</span><span class="o">=</span><span class="sb">`</span>ls -al <span class="nv">$1</span> <span class="p">|</span> awk <span class="s1">&#39;{ print $5 }&#39;</span><span class="sb">`</span>
        <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$size</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="nv">PRELOADER_FILE</span><span class="o">=</span><span class="s2">&quot;preloader-file&quot;</span>
<span class="nv">PRELOADER_OFFSET</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>
<span class="nv">UBOOT_FILE</span><span class="o">=</span><span class="s2">&quot;u-boot-file&quot;</span>
<span class="nv">UBOOT_OFFSET</span><span class="o">=</span><span class="s2">&quot;0x60000&quot;</span>
<span class="nv">BITSTREAM_FILE</span><span class="o">=</span><span class="s2">&quot;fpga-file&quot;</span>
<span class="nv">BITSTREAM_OFFSET</span><span class="o">=</span><span class="s2">&quot;0x100000&quot;</span>
<span class="nv">SCRIPT_FILE</span><span class="o">=</span><span class="s2">&quot;uboot.scr&quot;</span>
<span class="nv">SCRIPT_OFFSET</span><span class="o">=</span><span class="s2">&quot;0x880000&quot;</span>
<span class="nv">DEVICETREE_FILE</span><span class="o">=</span><span class="s2">&quot;devicetree.dtb&quot;</span>
<span class="nv">DEVICETREE_OFFSET</span><span class="o">=</span><span class="s2">&quot;0x840000&quot;</span>
<span class="nv">KERNEL_FILE</span><span class="o">=</span><span class="s2">&quot;uImage&quot;</span>
<span class="nv">KERNEL_OFFSET</span><span class="o">=</span><span class="s2">&quot;0x8C0000&quot;</span>
<span class="nv">ROOTFS_FILE</span><span class="o">=</span><span class="s2">&quot;rootfs.jffs2&quot;</span>
<span class="nv">ROOTFS_OFFSET</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>

flash_erase /dev/mtd0 <span class="m">0</span> 0
<span class="nv">FILESIZE</span><span class="o">=</span><span class="sb">`</span>getsize <span class="si">${</span><span class="nv">PRELOADER_FILE</span><span class="si">}</span><span class="sb">`</span>
<span class="nb">echo</span> Writing preloader file <span class="si">${</span><span class="nv">PRELOADER_FILE</span><span class="si">}</span> size <span class="si">${</span><span class="nv">FILESIZE</span><span class="si">}</span>
mtd_debug write /dev/mtd0 <span class="si">${</span><span class="nv">PRELOADER_OFFSET</span><span class="si">}</span> <span class="si">${</span><span class="nv">FILESIZE</span><span class="si">}</span> <span class="si">${</span><span class="nv">PRELOADER_FILE</span><span class="si">}</span>

<span class="nv">FILESIZE</span><span class="o">=</span><span class="sb">`</span>getsize <span class="si">${</span><span class="nv">UBOOT_FILE</span><span class="si">}</span><span class="sb">`</span>
<span class="nb">echo</span> Writing uboot file <span class="si">${</span><span class="nv">UBOOT_FILE</span><span class="si">}</span> size <span class="si">${</span><span class="nv">FILESIZE</span><span class="si">}</span>
mtd_debug write /dev/mtd0 <span class="si">${</span><span class="nv">UBOOT_OFFSET</span><span class="si">}</span> <span class="si">${</span><span class="nv">FILESIZE</span><span class="si">}</span> <span class="si">${</span><span class="nv">UBOOT_FILE</span><span class="si">}</span>

<span class="nv">FILESIZE</span><span class="o">=</span><span class="sb">`</span>getsize <span class="si">${</span><span class="nv">BITSTREAM_FILE</span><span class="si">}</span><span class="sb">`</span>
<span class="nb">echo</span> Writing bitstream file <span class="si">${</span><span class="nv">BITSTREAM_FILE</span><span class="si">}</span> size <span class="si">${</span><span class="nv">FILESIZE</span><span class="si">}</span>
mtd_debug write /dev/mtd0 <span class="si">${</span><span class="nv">BITSTREAM_OFFSET</span><span class="si">}</span> <span class="si">${</span><span class="nv">FILESIZE</span><span class="si">}</span> <span class="si">${</span><span class="nv">BITSTREAM_FILE</span><span class="si">}</span>

<span class="nv">FILESIZE</span><span class="o">=</span><span class="sb">`</span>getsize <span class="si">${</span><span class="nv">SCRIPT_FILE</span><span class="si">}</span><span class="sb">`</span>
<span class="nb">echo</span> Writing bootscript file <span class="si">${</span><span class="nv">SCRIPT_FILE</span><span class="si">}</span> size <span class="si">${</span><span class="nv">FILESIZE</span><span class="si">}</span>
mtd_debug write /dev/mtd0 <span class="si">${</span><span class="nv">SCRIPT_OFFSET</span><span class="si">}</span> <span class="si">${</span><span class="nv">FILESIZE</span><span class="si">}</span> <span class="si">${</span><span class="nv">SCRIPT_FILE</span><span class="si">}</span>

<span class="nv">FILESIZE</span><span class="o">=</span><span class="sb">`</span>getsize <span class="si">${</span><span class="nv">DEVICETREE_FILE</span><span class="si">}</span><span class="sb">`</span>
<span class="nb">echo</span> Writing devicetree <span class="si">${</span><span class="nv">DEVICETREE_FILE</span><span class="si">}</span> size <span class="si">${</span><span class="nv">FILESIZE</span><span class="si">}</span>
mtd_debug write /dev/mtd0 <span class="si">${</span><span class="nv">DEVICETREE_OFFSET</span><span class="si">}</span> <span class="si">${</span><span class="nv">FILESIZE</span><span class="si">}</span> <span class="si">${</span><span class="nv">DEVICETREE_FILE</span><span class="si">}</span>

<span class="nv">FILESIZE</span><span class="o">=</span><span class="sb">`</span>getsize <span class="si">${</span><span class="nv">KERNEL_FILE</span><span class="si">}</span><span class="sb">`</span>
<span class="nb">echo</span> Writing kernel file <span class="si">${</span><span class="nv">KERNEL_FILE</span><span class="si">}</span> size <span class="si">${</span><span class="nv">FILESIZE</span><span class="si">}</span>
mtd_debug write /dev/mtd0 <span class="si">${</span><span class="nv">KERNEL_OFFSET</span><span class="si">}</span> <span class="si">${</span><span class="nv">FILESIZE</span><span class="si">}</span> <span class="si">${</span><span class="nv">KERNEL_FILE</span><span class="si">}</span>

flash_erase /dev/mtd1 <span class="m">0</span> 0
<span class="nv">FILESIZE</span><span class="o">=</span><span class="sb">`</span>getsize <span class="si">${</span><span class="nv">ROOTFS_FILE</span><span class="si">}</span><span class="sb">`</span>
<span class="nb">echo</span> Writing rootfs file <span class="si">${</span><span class="nv">ROOTFS_FILE</span><span class="si">}</span> size <span class="si">${</span><span class="nv">FILESIZE</span><span class="si">}</span>
mtd_debug write /dev/mtd1 <span class="si">${</span><span class="nv">ROOTFS_OFFSET</span><span class="si">}</span> <span class="si">${</span><span class="nv">FILESIZE</span><span class="si">}</span> <span class="si">${</span><span class="nv">ROOTFS_FILE</span><span class="si">}</span>
</pre></div>
</div>
<p>Just make the script executable and execute it like this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>chmod +x flash.sh
./flash.sh
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please refer to the user documentation of the developer tools for more information.</p>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index_xilinx.html#document-index_xilinx">
              <img class="logo" src="_static/logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index_xilinx.html#document-index_xilinx">Table Of Contents</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="index_xilinx.html#document-introduction">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index_xilinx.html#version-information">Version Information</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index_xilinx.html#document-system">Build Environment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index_xilinx.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_xilinx.html#directory-structure">Directory Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_xilinx.html#repositories-structure">Repositories Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_xilinx.html#general-build-environment-configuration">General Build Environment Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index_xilinx.html#document-supported_devices_xilinx">Supported Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="index_xilinx.html#document-quickstart_xilinx">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index_xilinx.html#gui">GUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_xilinx.html#command-line">Command Line</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index_xilinx.html#deployment">Deployment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index_xilinx.html#sd-card-mmc">SD Card (MMC)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_xilinx.html#qspi-flash">QSPI Flash</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_xilinx.html#nand-flash">NAND Flash</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_xilinx.html#usb-drive">USB Drive</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_xilinx.html#nfs">NFS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index_xilinx.html#document-project_mode">Project mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="index_xilinx.html#document-faq">FAQ</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index_xilinx.html#how-to-script-u-boot">How to script U-Boot?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index_xilinx.html#how-can-the-flash-memory-be-programmed-from-linux">How can the flash memory be programmed from Linux?</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="index_xilinx.html#document-index_xilinx">Enclustra Build Environment - User Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright Antmicro Ltd for Enclustra GmbH, 2015.
      Last updated on 2016-07-15.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.4.
    </div>
  </body>
</html>